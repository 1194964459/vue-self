# 组件的本质

组件：一组DOM元素的封装。

## 一、组件是一个函数
因此，可以定义一个函数，这个函数的返回值就代表“组件要渲染的内容”（一组DOM元素）。

组件的返回值也是虚拟DOM：
```js
const MyComponent = function () {
  return {
    tag: 'div',
    props: {
      onClick: () => alert('hello')
    },
    children: 'click me'
  }
}
```

虚拟DOM对象中的tag属性来存储组件函数：
```js
const vnode = {
  tag: MyComponent
}
```

为了能够渲染组件，需要渲染器的支持。修改前面提到的 renderer 函数，如下所示：
```js
function renderer(vnode, container) {
  if (typeof vnode.tag === 'string') {
    // 说明 vnode 描述的是标签元素
    mountElement(vnode, container)
  } 
  else if (typeof vnode.tag === 'function') {
    // 说明 vnode 描述的是组件
    mountComponent(vnode, container)
  }
}
```
其中，mountComponent可这样表示：
```js
function mountComponent(vnode, container) {
  // 调用组件函数，获取组件要渲染的内容（虚拟 DOM）
  const subtree = vnode.tag()

  renderer(subtree, container)
}
```

## 二、组件是一个对象
举一反三，例如组件一定得是函数吗？

肯定不，组件是一组DOM元素的封装。只要能获取到这一组DOM元素即可，不必非得是函数才行。

```js
// MyComponent 是一个对象，里面有个render函数
const MyComponent = {
  render() {
    return {
      tag: 'div',
      props: {
        onClick: () => alert('hello')
      },
      children: 'click me'
    }
  }
}
```

现在我们使用对象而不是函数来表达组件，因此要将typeof vnode.tag === 'function' 修改为 typeofvnode.tag === 'object'。

mountComponent对象判读也应修改下：

```js
function renderer(vnode, container) {
  if (typeof vnode.tag === 'string') {
    mountElement(vnode, container)
  } else if (typeof vnode.tag === 'object') { // 如果是对象，说明 vnode 描述的是组件
    mountComponent(vnode, container)
  }
}

function mountComponent(vnode, container) {
  // vnode.tag 是组件对象，调用它的 render 函数得到组件要渲染的内容（虚拟 DOM）
  const subtree = vnode.tag.render()
  // 递归地调用 renderer 渲染 subtree
  renderer(subtree, container)
}
```